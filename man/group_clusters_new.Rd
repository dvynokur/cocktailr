% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/group_clusters_new.R
\name{group_clusters_new}
\alias{group_clusters_new}
\title{Group Cocktail clusters by fuzzy species membership}
\usage{
group_clusters_new(
  x,
  vegmatrix,
  clusters,
  phi_fuzzy = 0.3,
  min_species = 3L,
  dist_method = c("bray", "jaccard", "euclidean", "manhattan", "correlation"),
  hclust_method = "average"
)
}
\arguments{
\item{x}{A \code{"cocktail"} object (result of \code{\link{cocktail_cluster}}).}

\item{vegmatrix}{A matrix or data.frame with \strong{plots in rows} and
\strong{species in columns}, containing the original vegetation data used for
clustering. Row names must include (and will be reordered to) the plots
in \code{x}; column names must include the species used in \code{x}.}

\item{clusters}{Cluster identifiers to be grouped. Can be:
\itemize{
\item a \strong{vector} of node labels/IDs (e.g., \code{c("c_12","c_27")} or
\code{c(12,27)}), each defining a separate group; or
\item a \strong{list}, where each element is a vector of node labels/IDs to be
\strong{unioned} into a single group (OR of their plot memberships),
e.g. \code{list(c("c_12","c_34"), 57)}.
}}

\item{phi_fuzzy}{Numeric in (0,1); species with \eqn{\phi <} \code{phi_fuzzy}
for a given group are set to 0 for that group. Defaults to 0.30. Use
\code{phi_fuzzy = 0} to keep the full \eqn{\phi} vectors (no threshold).}

\item{min_species}{Integer ≥ 1. Minimum number of species in the
\strong{topological Cocktail group} (union of the selected nodes). Any group
whose union has fewer than this many species is dropped \emph{before}
computing fuzzy \eqn{\phi} and dissimilarities. Default 3.}

\item{dist_method}{Character; method for computing dissimilarities between
groups based on their fuzzy species profiles. One of
\code{c("bray","jaccard","euclidean","manhattan","correlation")}.
\itemize{
\item \code{"bray"}: Bray--Curtis dissimilarity.
\item \code{"jaccard"}: 1 − Jaccard similarity (using fuzzy abundances).
\item \code{"euclidean"}, \code{"manhattan"}: passed to \code{\link[stats]{dist}}.
\item \code{"correlation"}: 1 − Pearson correlation between group profiles.
}}

\item{hclust_method}{Character; linkage method passed to
\code{\link[stats]{hclust}} (e.g. \code{"average"}, \code{"complete"},
\code{"single"}, ...).}
}
\value{
An \code{\link[stats]{hclust}} object. The result carries attributes:
\itemize{
\item \code{"phi_matrix"} — the species × group \eqn{\phi} matrix
(after applying \code{phi_fuzzy});
\item \code{"groups"} — the final group labels used in clustering;
\item \code{"clusters"} — the original \code{clusters} argument;
\item \code{"species_per_group_topo"} — number of \strong{topological}
species per retained group (union of Cocktail nodes).
}
}
\description{
Given a set of Cocktail nodes (e.g. from \code{\link{clusters_at_cut}}),
recompute \strong{direct (Option A)} \eqn{\phi} for all species versus the
\strong{union groups} defined by these nodes (as in
\code{assign_releves}(strategy = "fuzzy")), then compute a dissimilarity
between groups based on their fuzzy species profiles and perform
hierarchical clustering.
}
\details{
The function first builds a plots × groups membership matrix \eqn{G} by
taking the OR-union of the selected node columns in \code{x$Plot.cluster}
for each group, and a corresponding union of species membership from
\code{x$Cluster.species}. Groups whose topological species sets contain
fewer than \code{min_species} species are dropped.

It then recomputes \strong{direct (Option A)} \eqn{\phi} for all species
(from \code{vegmatrix}, binarized) against these group membership vectors,
exactly as in the \code{"fuzzy"} branch of \code{\link{assign_releves}}.
Species with \eqn{\phi <} \code{phi_fuzzy} for a group are set to 0; the
resulting columns (groups) are fuzzy species profiles. Dissimilarities
between groups are computed from these profiles using the chosen
\code{dist_method}, and hierarchical clustering is performed with
\code{\link[stats]{hclust}} and the requested \code{hclust_method}.

Intuitively, \code{min_species} controls how “small” a Cocktail group
(in terms of its topological species set) is allowed to be, whereas
\code{phi_fuzzy} controls how strict you are about species–group fidelity
when constructing fuzzy profiles.
}
\seealso{
\code{\link{clusters_at_cut}}, \code{\link{assign_releves}},
\code{\link{cocktail_cluster}}
}
