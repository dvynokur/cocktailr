% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cluster_phi_dist.R
\name{cluster_phi_dist}
\alias{cluster_phi_dist}
\title{Distance between Cocktail clusters based on species fidelity (phi)}
\usage{
cluster_phi_dist(x, clusters = NULL, min_phi = 0.2)
}
\arguments{
\item{x}{A \code{"cocktail"} object (result of \code{\link{cocktail_cluster}}),
containing at least:
\itemize{
\item \code{Cluster.species} - nodes x species (0/1),
\item \code{Cluster.height} - numeric vector of merge phi for each node, and
\item \code{Species.cluster.phi} - species x nodes phi-matrix.
}
Note: \code{Species.cluster.phi} is only present if
\code{species_cluster_phi = TRUE} was used in \code{\link{cocktail_cluster}}.}

\item{clusters}{Optional cluster identifiers (nodes) to be compared. Can be a
numeric vector of node indices (e.g. \code{c(12, 27)}) or a character vector
of node labels (e.g. \code{c("c_12", "c_27")}). Each element refers to a
single internal node; no grouping/union is performed.
If \code{NULL} or missing, \strong{all} internal nodes
\code{1:nrow(x$Cluster.species)} are candidates.}

\item{min_phi}{Numeric scalar; minimum merge phi (cluster height) required for a
node to be retained. Default \code{0.2}. Nodes whose corresponding
\code{x$Cluster.height} value is \emph{strictly less} than \code{min_phi}
are dropped before computing the phi-based distance. If, after applying
\code{clusters} and \code{min_phi}, fewer than two nodes remain, an error
is raised.}
}
\value{
A \code{\link[stats]{dist}} object of pairwise distances between the clusters.
No additional attributes are attached; you can pass the result directly to
\code{\link[stats]{hclust}} or other clustering/ordination functions.
}
\description{
Compute a phi-based distance between a set of Cocktail clusters (internal nodes).
For each cluster, a species fidelity profile is taken directly from
\code{x$Species.cluster.phi}, restricted to the cluster's topological species
set. Pairwise distances between clusters are then derived from these profiles
via a symmetric similarity measure.
}
\details{
Let \eqn{\phi(s, k)} be the phi-coefficient between species \eqn{s}
and cluster \eqn{k}, stored in \code{x$Species.cluster.phi}. For each
cluster \eqn{k}:

\enumerate{
\item Its \strong{topological species set} \eqn{S_k} is defined as the set of
species with membership 1 in \code{x$Cluster.species[k,]}.
\item A species fidelity profile \eqn{\phi_k(s)} is taken as
\eqn{\phi(s,k)} for \eqn{s \in S_k}, and 0 for species outside
\eqn{S_k}. All negative phi values are set to 0 beforehand, so only
positive fidelity contributes.
}

Only nodes with \code{x$Cluster.height >= min_phi} are retained for distance
computation (after any user-specified filtering via \code{clusters}).

For any pair of clusters \eqn{A,B}, define:

\deqn{
  \mathrm{sim}(A \to B) =
    \frac{\sum_{s \in S_A} \phi_B(s)}
         {\sum_{s \in S_A} \phi_A(s)}
}

with the convention that if the denominator is 0 (no positive phi for
\eqn{A}), then \eqn{\mathrm{sim}(A\to B) = 0}. The symmetric similarity is

\deqn{
  \mathrm{sim}_{\mathrm{sym}}(A,B) =
    \frac{1}{2}\left[ \mathrm{sim}(A\to B) + \mathrm{sim}(B\to A) \right],
}

and the distance is \eqn{d(A,B) = 1 - \mathrm{sim}_{\mathrm{sym}}(A,B)}.
}
\seealso{
\code{\link{cocktail_cluster}}, \code{\link{clusters_at_cut}}
}
