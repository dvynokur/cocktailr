% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/select_clusters.R
\name{select_clusters}
\alias{select_clusters}
\title{Select Cocktail clusters using a combined score based on merge phi, size, and m-threshold}
\usage{
select_clusters(
  x,
  clusters = NULL,
  min_phi = 0.2,
  min_k = 1L,
  min_score = 1,
  mode = c("strict", "top"),
  return = c("labels", "ids", "table")
)
}
\arguments{
\item{x}{A \code{"cocktail"} object (result of \code{\link{cocktail_cluster}}),
containing at least \code{Cluster.species}, \code{Cluster.height}, and
\code{Cluster.info} with columns \code{"k"} and \code{"m"}.}

\item{clusters}{Optional cluster identifiers (nodes) to consider. Can be a numeric
vector of node indices (e.g. \code{c(12, 27)}) or a character vector of labels
(e.g. \code{c("c_12", "c_27")}). Each element refers to a single internal node.
If \code{NULL} or missing, all internal nodes \code{1:nrow(x$Cluster.species)}
are candidates.}

\item{min_phi}{Numeric scalar; minimum merge phi required to keep a node.
Default \code{0.2}. Nodes with \code{Cluster.height < min_phi} are dropped.}

\item{min_k}{Integer; minimum number of species \code{k} required for a cluster
to be eligible. Default \code{1}. This can be used to filter out very small
clusters.}

\item{min_score}{Numeric scalar; minimum score required for a cluster to be eligible.
Default \code{1}. Set to \code{0} to allow the full selection (no score filtering).}

\item{mode}{Character; nesting rule used when constructing the final selection.
\itemize{
\item \code{"strict"} (default): exclude both ancestors and descendants of
already selected clusters (no nested clusters are returned).
\item \code{"top"}: keep only hierarchically highest clusters among the
eligible set (drop descendants if an eligible ancestor exists).
}}

\item{return}{What to return:
\itemize{
\item \code{"labels"} (default): character labels like \code{"c_12"}.
\item \code{"ids"}: integer node IDs.
\item \code{"table"}: a data frame with selected clusters and their \code{h,k,m,score}.
}}
}
\value{
Depending on \code{return}:
\itemize{
\item \code{"labels"}: character vector of selected cluster labels.
\item \code{"ids"}: integer vector of selected node IDs.
\item \code{"table"}: data frame of selected clusters sorted by decreasing score.
}
}
\description{
Selects internal Cocktail clusters (nodes) by ranking them with a combined score
based on the Cocktail merge height \code{h} (phi), the number of species \code{k},
and the Cocktail membership threshold \code{m}.

The scoring function is:
\deqn{
\mathrm{score}(k) = h_k \cdot \log(k_k) \cdot \log(m_k),
}
where:
\itemize{
\item \code{h_k} is \code{x$Cluster.height[k]} (merge phi),
\item \code{k_k} is \code{x$Cluster.info[k,"k"]} (cluster size),
\item \code{m_k} is \code{x$Cluster.info[k,"m"]} (Cocktail membership threshold).
}

Clusters are selected strongest-first, using a greedy procedure in which eligible
clusters are considered in descending score order (ties broken by larger \code{k},
then smaller node ID).

Nesting is controlled by \code{mode}:
\itemize{
\item \code{mode = "strict"} (default): \strong{no nesting allowed}.
After selecting a cluster, \emph{all} of its strict ancestors and strict
descendants are excluded. Therefore, the final selection contains no nested
clusters (no strict subset/superset relationships between selected clusters
based on topological species sets from \code{x$Cluster.species}).
\item \code{mode = "top"}: \strong{hierarchically highest clusters among eligible}.
All eligible clusters (\code{score >= min_score}) are first collected.
The final selection then keeps only those clusters that are not strict
descendants of another eligible cluster. In other words, if a cluster has an
eligible ancestor, it is removed and the ancestor is kept.
}
}
