% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/assign_releves_new.R
\name{assign_releves_new}
\alias{assign_releves_new}
\title{Hierarchical plot assignment across multiple phi levels}
\usage{
assign_releves_new(
  x,
  tab,
  strategy = c("cover", "topology_fuzzy", "fuzzy"),
  phi_cut = 0.3,
  cover_transform = c("sqrt", "none", "log1p"),
  min_cover = 0,
  phi_fuzzy = NULL,
  choose_level = c("finest", "coarsest")
)
}
\arguments{
\item{x}{Cocktail object (list) with components:
\code{Cluster.species}, \code{Cluster.merged}, \code{Cluster.height}, \code{Plot.cluster}.}

\item{tab}{Numeric matrix/data.frame of \strong{covers} (plots × species).
Required for all strategies here.}

\item{strategy}{One of \code{c("cover","topology_fuzzy","fuzzy")}.}

\item{phi_cut}{Numeric in (0,1). Only φ levels \strong{≥ phi_cut} are considered.}

\item{cover_transform}{Cover transform: \code{c("sqrt","none","log1p")}. Default \code{"sqrt"}.}

\item{min_cover}{Numeric percent in (0, 100). Plot–group pair is ineligible
unless raw (pre-transform) sum of the group's species in the plot ≥ this value.}

\item{phi_fuzzy}{Fidelity cutoff for \code{"fuzzy"} (defaults to \code{phi_cut}).}

\item{choose_level}{Which level to use for the final single assignment:
\code{"finest"} (default; the highest φ with unique assignment), or \code{"coarsest"}
(the lowest φ ≥ \code{phi_cut} with unique assignment). You can always switch
later using the \code{levels$level_id} information stored in the result.}
}
\value{
A list with:
\itemize{
\item \code{assignment}: named character vector (plots → group label at the chosen level),
or \code{"not assigned"} when no unique winner at any level.
\item \code{per_level}: data.frame of per-level assignments (long form):
plot, level_id, phi, group (or "not assigned").
\item \code{levels}: data.frame describing all groups at all levels with
\code{level_id}, \code{phi}, \code{group}, \code{node_id},
\code{parent_group} (in the next coarser level), \code{n_plots}.
\item \code{details}: list with inputs and diagnostics (e.g., transforms,
strategy, and a small map to help remap to other levels later).
}
}
\description{
Assign each plot to a Cocktail cluster \strong{at all φ levels >= \code{phi_cut}} and
keep a single final assignment (by default from the \strong{finest} level, i.e.,
the highest φ where the plot has a unique winner). Supports three strategies:
\itemize{
\item \strong{"cover"} — like "topology_cover" (scores by transformed covers of a
group's \emph{topological} species), but computed at each φ level.
\item \strong{"topology_fuzzy"} — like in \code{assign_releves()}:
recompute \strong{direct (Option A)} φ for species vs. the group (OR-union of
the group's nodes; here each group is a single parent node), then \strong{mask}
to \emph{topological species} for that node; score by covers × masked φ.
\item \strong{"fuzzy"} — recompute \strong{direct} φ for species vs. group; then drop
species with φ < \code{phi_fuzzy}; score by covers × filtered φ.
}

For each level we enforce \strong{unique maximum} per plot among eligible groups.
Eligibility requires (raw, pre-transform) cover sum for the group's species
≥ \code{min_cover}. (For "fuzzy", eligibility uses the \strong{filtered} species set.)
}
