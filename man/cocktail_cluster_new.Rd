% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/cocktail_cluster_new.R
\name{cocktail_cluster_new}
\alias{cocktail_cluster_new}
\title{Cocktail clustering (sparse, parity with original, bounded merges; robust IDs)}
\usage{
cocktail_cluster_new(
  vegmatrix,
  binarize = TRUE,
  progress = TRUE,
  fallback_when_nonpos = TRUE,
  fallback_max_cols = 600L
)
}
\arguments{
\item{vegmatrix}{Numeric matrix or data.frame; plots in rows, species in columns.}

\item{binarize}{Logical; convert to presence/absence (default TRUE).}

\item{progress}{Logical; show a text progress bar (default TRUE).}

\item{fallback_when_nonpos}{Logical; if TRUE, when max φ ≤ 0 compute that round
with vegan::designdist for exact parity. Default TRUE.}

\item{fallback_max_cols}{Integer; only use the fallback if the current number
of columns is ≤ this value (prevents stalls on huge rounds). Default 600.}
}
\value{
A list of class \code{"cocktail"} with:
\itemize{
\item \code{Cluster.species}: (n-1) x n integer matrix; species membership per cluster
\item \code{Cluster.info}:   (n-1) x 2 integer matrix; columns \code{k} (size), \code{m} (min spp per plot)
\item \code{Plot.cluster}:    N x (n-1) integer matrix; plot assignment per cluster
\item \code{Cluster.merged}:  (n-1) x 2 integer matrix; negative = species id, positive = cluster id
\item \code{Cluster.height}:  numeric vector of length n-1; phi at which each merge formed
\item \code{species}, \code{plots}: character vectors with names from input
}
}
\description{
Runs the Cocktail hierarchical agglomeration on a plots x species matrix.
Each round uses a single sparse crossproduct to compute co-occurrences and
φ from (a,b,c,d) via the same (ad−bc)/sqrt(...) form as vegan::designdist.
Ties are ordered to match the lower-triangle "dist" indexing. When the
current max φ is nonpositive, an optional fallback evaluates the round
with vegan::designdist for exact parity (including a=0 pairs).
Importantly, this version records merges using \strong{tracked indices} instead
of name matching, so the first merge cannot drift even with tricky names.
}
