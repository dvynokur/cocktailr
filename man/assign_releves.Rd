% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/assign_releves.R
\name{assign_releves}
\alias{assign_releves}
\title{Assign plots to Cocktail groups (strict or fuzzy)}
\usage{
assign_releves(
  x,
  vegmatrix,
  mode = c("strict", "fuzzy"),
  phi = 0.3,
  cover_transform = c("sqrt", "none", "log1p"),
  compare = c("max", "one_vs_rest"),
  min_cover = 0,
  min_group_size = 1,
  phi_mode = NULL
)
}
\arguments{
\item{x}{A Cocktail result (list with \code{Cluster.species}, \code{Cluster.merged},
\code{Cluster.height}; typically from \code{cocktail_cluster()}).}

\item{vegmatrix}{Numeric matrix/data.frame of covers with plots in rows and species
in columns. Missing values are treated as 0.}

\item{mode}{Assignment mode: \code{"strict"} or \code{"fuzzy"}.}

\item{phi}{Numeric \eqn{\phi} cut (between 0 and 1) used to define parent clusters.}

\item{cover_transform}{Transformation applied to covers before scoring:
\code{"sqrt"} (default), \code{"none"}, or \code{"log1p"}.}

\item{compare}{Rule for choosing a winner per plot:
\itemize{
\item \code{"max"} — assign only if there is a unique maximum score; otherwise \code{"not assigned"}.
\item \code{"one_vs_rest"} — assign only if the best score is strictly greater than
the sum of all other groups’ scores; otherwise \code{"not assigned"}.
}}

\item{min_cover}{Numeric threshold for \strong{raw} (pre-transform) cover, expressed in percent
of the plot (between 0 and 100). A plot can be assigned to a group only if the sum of raw
covers of that group’s species in the plot is at least this value. Default is 0.}

\item{min_group_size}{Integer \eqn{\ge} 1. After initial assignment, any group with fewer
than this many plots is relabeled \code{"not assigned"}. Default is 1 (no collapsing).}

\item{phi_mode}{(Fuzzy mode only) how to treat per-species \eqn{\phi} weights:
\code{"thresh"} (set \eqn{\phi <} \code{phi} to 0),
\code{"positive"} (set \eqn{\phi \le 0} to 0; default),
or \code{"all"} (keep raw values; negatives penalize).}
}
\value{
A named character vector giving the assigned group for each plot. An attribute
\code{"details"} is attached with inputs and diagnostics, including the score matrix and
a data frame of per-plot summaries.
}
\description{
Assign each plot to one parent Cocktail group at a given \eqn{\phi} cut.
In \strong{strict} mode, groups are scored by the summed (optionally transformed)
covers of their member species. In \strong{fuzzy} mode, species are weighted by
their \eqn{\phi} values against the parent groups (computed from
\code{x$Plot.cluster}), and plot scores are cover–\eqn{\phi} weighted sums.
}
\details{
Parent clusters are the “topmost” nodes with height \eqn{\ge} \code{phi} (i.e., nodes above the
cut that have no ancestor also above the cut).
In strict mode, the score for a plot–group pair is the sum of transformed covers across species
that belong to that parent group.
In fuzzy mode, a species-by-nodes \eqn{\phi} matrix is computed for all internal nodes from
\code{x$Plot.cluster}, restricted to the parent groups at \code{phi}, optionally filtered by
\code{phi_mode}, and plot scores are obtained by multiplying transformed covers by these \eqn{\phi}
weights. The \code{compare} rule then determines whether a unique winner exists for each plot.

The \code{min_cover} check is applied in both modes (using raw, untransformed covers); ineligible
plot–group pairs are discarded prior to comparison. Finally, \code{min_group_size} can collapse
very small winning groups to \code{"not assigned"}.
}
\seealso{
\code{\link{cocktail_fuzzy}}
}
